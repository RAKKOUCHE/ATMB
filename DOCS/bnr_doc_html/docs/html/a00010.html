<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BNR API for .NET: How to ...</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BNR API for .NET
   &#160;<span id="projectnumber">2.0.x</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00010.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">How to ... </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="how_to_recover_after_app_crash"></a>
How to recover after a host application crash</h1>
<p>After an application crash, the BNR can be in 4 different states :</p><ul>
<li>not operational state</li>
<li>cashInActive state</li>
<li>cashIn in progress state</li>
<li>dispense active state</li>
</ul>
<p>Steps to recover from any of these cases are :</p><ol type="1">
<li>When the application restarts, do a call to <a class="el" href="a00335.html#gadd9c7f0fea7e02efde526ffccc1189af" title="The function Open starts the thread to monitor the BNR and to communicate with it. ">Mei::Bnr::Bnr::Open()</a>, followed by a <a class="el" href="a00173.html" title="Status Class ">Mei::Bnr::Status</a> property check. If the deviceStatus is :<ul>
<li><a class="el" href="a00355.html#gga707c6b00064fc5acda2652922bebc73aa7fd67633e31b9bb36438b53def8cf0e5" title="A person has stopped the device operation. ">Mei::Bnr::DeviceStatus::UserError</a> - Close the system and call <a class="el" href="a00335.html#gab82c292c5d3bc0ea74542b89310ee8a8" title="This method is used to put the BNR into a defined operational state. ">Mei::Bnr::Bnr::Reset()</a> and wait for Operation Complete event. If result is successful, the BNR is ready for any operation.</li>
<li><a class="el" href="a00344.html#gga7dd8661d45a6d3d67d081bd92f804fc4a6fd93efdeb890cd65ec1c0a1462f3ac0" title="The device is not operational. ">Mei::Bnr::DeviceStatus::OffLine</a> - Call <a class="el" href="a00335.html#gab82c292c5d3bc0ea74542b89310ee8a8" title="This method is used to put the BNR into a defined operational state. ">Mei::Bnr::Bnr::Reset()</a> and wait for Operation Complete event. If result is successful, the BNR is ready for any operation.</li>
<li><a class="el" href="a00355.html#gga707c6b00064fc5acda2652922bebc73aa4852946e074a1f48ed7de9a024b10c03">Mei::Bnr::DeviceStatus::HardwareError</a> - There is an error on a module, use Bnr.SystemStatusOverview property or <a class="el" href="a00110.html" title="Root class for all modules. ">Mei::Bnr::Module::Module</a> Status property to know which module has error.</li>
<li><a class="el" href="a00344.html#gga7dd8661d45a6d3d67d081bd92f804fc4a91cb66e6da94695674115161d25c0235" title="The device is present and operational. ">Mei::Bnr::DeviceStatus::OnLine</a> and <a class="el" href="a00344.html#gga94618a8dde10cc6464a435d1dba0a28cac3bf447eabe632720a3aa1a7ce401274" title="The shutter is open. ">Mei::Bnr::ShutterStatus::Open</a> - There is bills at outlet. Wait until they are taken and then go to the next step 2.</li>
<li><a class="el" href="a00344.html#gga7dd8661d45a6d3d67d081bd92f804fc4a91cb66e6da94695674115161d25c0235" title="The device is present and operational. ">Mei::Bnr::DeviceStatus::OnLine</a> and <a class="el" href="a00344.html#gga94618a8dde10cc6464a435d1dba0a28ca03f4a47830f97377a35321051685071e" title="The shutter is closed. ">Mei::Bnr::ShutterStatus::Closed</a> - Go to the next step 2.</li>
</ul>
</li>
<li>In order to know if the BNR is in any other state, do a <a class="el" href="a00336.html#gae856d0ef126d131b64448446ef05917a" title="This command is used to start the cash in transaction with the BNR. ">Mei::Bnr::Bnr::CashInStart()</a>. If returned code is any positive value Wait for Operation Complete event, call <a class="el" href="a00336.html#ga98f3d4f2d67ea238544f895c38ab990b" title="This command is used to end the cash in transaction. ">Mei::Bnr::Bnr::CashInEnd()</a> and wait for Operation Complete event again. The BNR is ready for any operation. Else you will catch either BnrUsbException, BnrXfsException, or BnrApiException. If exception is BnrXfsException and (BnrXfsErrorCode)BnrXfsException.Code is :<ul>
<li><a class="el" href="a00355.html#gga707c6b00064fc5acda2652922bebc73aae84f44f0c258f08a2d6fb9252578eb1b" title="The device has already issued a cashInStart command. ">Mei::Bnr::BnrXfsErrorCode::CashInActive</a> - A <a class="el" href="a00336.html#gae856d0ef126d131b64448446ef05917a" title="This command is used to start the cash in transaction with the BNR. ">Mei::Bnr::Bnr::CashInStart()</a> call was made before the crash. Call <a class="el" href="a00336.html#ga98f3d4f2d67ea238544f895c38ab990b" title="This command is used to end the cash in transaction. ">Mei::Bnr::Bnr::CashInEnd()</a> and wait for Operation Complete, the BNR is ready for any operation.</li>
<li><a class="el" href="a00355.html#gga707c6b00064fc5acda2652922bebc73aa71f91e12ab77fda34a39063650e3b2e7" title="Illegal request. ">Mei::Bnr::BnrXfsErrorCode::Illegal</a> - Either a <a class="el" href="a00336.html#ga43c62ec6310b978b9f30982c0bd578e3" title="This command will cause inserted notes to be moved to the escrow. ">Mei::Bnr::Bnr::CashIn()</a> is in progress or the BNR is in dispense active state. Go to the next step 3.</li>
</ul>
</li>
<li>Call <a class="el" href="a00336.html#gae6cae9cff8870c1443c040d5d687abf4" title="Attempts to cancel the current asynchronous operation. ">Mei::Bnr::Bnr::Cancel()</a> and wait up to 5 seconds (time out) for Operation Complete Event.<ul>
<li>If the Operation Complete event is received. A <a class="el" href="a00336.html#ga43c62ec6310b978b9f30982c0bd578e3" title="This command will cause inserted notes to be moved to the escrow. ">Mei::Bnr::Bnr::CashIn()</a> was called before the crash, call <a class="el" href="a00336.html#ga98f3d4f2d67ea238544f895c38ab990b" title="This command is used to end the cash in transaction. ">Mei::Bnr::Bnr::CashInEnd()</a> and wait for OperationComplete event, the BNR is ready for any operation.</li>
<li>If the time out occurs before the event. A <a class="el" href="a00336.html#ga5e9de7b5d8bc0fa649dfaacf66f82f93" title="Dispenses the amount of money that is specified by the amount and currencyCode parameter. ">Mei::Bnr::Bnr::Dispense()</a> was called before the crash, call <a class="el" href="a00335.html#gab82c292c5d3bc0ea74542b89310ee8a8" title="This method is used to put the BNR into a defined operational state. ">Mei::Bnr::Bnr::Reset()</a> to store the bills that are in the bundler or call <a class="el" href="a00336.html#ga890c5fe2db6961e247607b18b0c5096e" title="This command activates the presentation of the cash. ">Mei::Bnr::Bnr::Present()</a> to terminate the transaction. Wait Operation Complete event. The BNR is ready for any operation.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="how_to_recover_from_usb_error"></a>
How to recover from USB communication error</h1>
<p>In case of USB communication trouble between the BNR and the host application, method calls and access to properties will raise a <a class="el" href="a00021.html" title="USB category exception. ">Mei::Bnr::BnrUsbException</a>. <br />
<br />
First action to take is to check that BNR is connected to the PC through an USB port, and powered. <br />
<br />
For synchronous operation, apply the following sequence of calls on the API :</p><ul>
<li>try again the previous operation (method call or property read/write).</li>
<li>If a <a class="el" href="a00017.html" title="API category exception. ">Mei::Bnr::BnrApiException</a> is raised with code result is <a class="el" href="a00355.html#gga728f9da850009297affc528c0f6feb97ad6e851605156fa5f4814b1e63aee76d4" title="The library was not opened by a previous Bnr::Bnr::Open() call. ">Mei::Bnr::BnrApiErrorCode::NotOpened</a>, then <a class="el" href="a00335.html#gadd9c7f0fea7e02efde526ffccc1189af" title="The function Open starts the thread to monitor the BNR and to communicate with it. ">Mei::Bnr::Bnr::Open()</a> and process error as usual or stop because the BNR is disconnected.</li>
</ul>
<p><br />
For asynchronous operation, apply the following sequence of calls on the API :</p><ul>
<li>Read <a class="el" href="a00181.html" title="Transaction Status properties. ">Mei::Bnr::TransactionStatus</a> to determine if there is already an asynchronous operation running.</li>
<li>If a <a class="el" href="a00017.html" title="API category exception. ">Mei::Bnr::BnrApiException</a> is raised with code result is <a class="el" href="a00355.html#gga728f9da850009297affc528c0f6feb97ad6e851605156fa5f4814b1e63aee76d4" title="The library was not opened by a previous Bnr::Bnr::Open() call. ">Mei::Bnr::BnrApiErrorCode::NotOpened</a>, then <a class="el" href="a00335.html#gadd9c7f0fea7e02efde526ffccc1189af" title="The function Open starts the thread to monitor the BNR and to communicate with it. ">Mei::Bnr::Bnr::Open()</a> and process error as usual or stop because the BNR is disconnected.</li>
<li>If an asynchronous operation is running, wait for its OperationComplete event.</li>
<li>If no asynchronous operation is running, then try again the previous operation, and:<ul>
<li>If a <a class="el" href="a00017.html" title="API category exception. ">Mei::Bnr::BnrApiException</a> is raised with code result is <a class="el" href="a00355.html#gga728f9da850009297affc528c0f6feb97ad6e851605156fa5f4814b1e63aee76d4" title="The library was not opened by a previous Bnr::Bnr::Open() call. ">Mei::Bnr::BnrApiErrorCode::NotOpened</a>, then <a class="el" href="a00335.html#gadd9c7f0fea7e02efde526ffccc1189af" title="The function Open starts the thread to monitor the BNR and to communicate with it. ">Mei::Bnr::Bnr::Open()</a> and process error as usual or stop because the BNR is disconnected.</li>
<li>else if no exception is raised wait for OperationComplete event.</li>
</ul>
</li>
</ul>
<p><br />
<a class="el" href="a00354.html#gafb9ae90890afc1a95730328f2239cf37" title="This function is used to kill and reload device driver. ">Mei::Bnr::Bnr::KillUsbAndReload()</a> maybe the last trial to recover communication. If the BNR USB driver is enabled, this command will disable and then re-enable it at Windows system level. If the calling application crashes during this function, the USB driver may stay disabled. Then, another call to this command will have no effect because the driver is not enabled already. The driver will have to be enabled manually. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      The information contained here-in is the property of MEI and is not to be disclosed 
      or used without the prior written permission of MEI. This copyright extends to all media in 
      which this information may be preserved including magnetic storage, computer print-out or 
      visual display.
    </li>
    <li class="footer" style="float:right; position: relative; top:-10px;">Generated on Tue Jul 3 2018 for BNR API for .NET by&nbsp;
      <a href="http://www.doxygen.org/index.html">doxygen</a> 1.8.10</li>
  </ul>
</div>
</body>
</html>
